# DNSLookup Processor

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: traces, metrics, logs   |
| Distributions | [] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aprocessor%2Fdnslookup%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aprocessor%2Fdnslookup) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aprocessor%2Fdnslookup%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aprocessor%2Fdnslookup) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@andrzej-stencel](https://www.github.com/andrzej-stencel), [@kaisecheng](https://www.github.com/kaisecheng), [@edmocosta](https://www.github.com/edmocosta) |

[development]: https://github.com/open-telemetry/opentelemetry-collector#development
<!-- end autogenerated section -->

## Overview

The DNSLookup processor `dnslookupprocessor` performs forward (hostname to IP) and/or reverse DNS lookups (IP to hostname), and store the result in caches. It enriches resource attributes with the first resolution, preferring IPv4. The lookup supports multiple hostfiles and DNS servers.

## Resolution Order and Retry Mechanism
The processor implements a chain of resolvers with the following resolution order

1. Hostfiles - when hostname is not in files, the processor continues to the next resolver in the chain. Note that later hostfiles in the list take precedence over earlier ones for duplicate entries.
2. Custom DNS servers - "no resolution" is a valid result and the chain stops. For each DNS server, temporary failures trigger retries. The resolver prefers IPv4 addresses over IPv6 when both are available.
3. System resolver - same as (2), uses the operating system's default DNS as the final fallback

## Caching
- Successful resolutions are cached in a "hit cache" with configurable TTL
- Failed lookups are cached in a "miss cache" with TTL to avoid repeated expensive failures
- Both caches implement LRU eviction policies

## Config

Some notable settings include:

- `context` (default: `resource`): Allows specifying the underlying telemetry context the processor will work with. Available values:
  - `resource`: Resource attributes.
  - `record`: Attributes within a data point, log record or a span.
- `attributes`: An array of attribute names, which are used for lookup. The first valid hostname/IP is used.
  - [`source.address`](https://github.com/open-telemetry/semantic-conventions/blob/v1.32.0/docs/general/attributes.md#source) is the default for forward resolution. 
  - `source.ip` is the default for reverse resolution.
- `resolved_attribute`: The attribute name where the resolved result will be stored.
  - `source.ip` is the default for forward resolution.
  - [`source.address`](https://github.com/open-telemetry/semantic-conventions/blob/v1.32.0/docs/general/attributes.md#source) is the default for reverse resolution.


```yaml
processors:
  dnslookup:
    # Forward DNS resolution configuration (hostname to IP)
    # Default: enabled
    resolve:
      enabled: true
      # Context for attributes: "resource" or "record".
      context: "record"
      # List of attributes to check for hostnames. The first valid hostname is used.
      attributes: ["source.address"]
      # Attribute to store the resolved IP.
      resolved_attribute: "source.ip"

    # Reverse DNS resolution configuration (IP to hostname)
    # Default: disabled
    reverse:
      enabled: false
      # Context for attributes: "resource" or "record".
      context: "record"
      # List of attributes to check for IPs. The first valid IP is used.
      attributes: ["source.ip"]
      # Attribute to store the resolved hostname.
      resolved_attribute: "source.address"

    # Maximum number of failed resolutions to cache.
    miss_cache_size: 1000
    # Time-to-live (seconds) for failed resolution cache entries.
    miss_cache_ttl: 60
    # Maximum number of successful resolutions to cache.
    hit_cache_size: 10000 
    # Time-to-live (seconds) for successful resolution cache entries.
    hit_cache_ttl: 300
    # Maximum number of retry attempts for DNS lookups.
    max_retries: 1
    # Timeout (seconds) for individual DNS lookups.
    timeout: 0.5
    
    # Path to custom hosts files.
    hostfiles: 
      - "/path/to/hosts/file"
      - "/path/to/other/hosts"
    
    # Address of custom DNS servers.
    nameservers:
      - 8.8.8.8
      - 1.1.1.1
    
    # Enable the system resolver. 
    enable_system_resolver: true
```

### Hostfiles

Hosts example:

```
127.0.0.1       localhost
192.168.1.10    myserver.local  myserver
```
